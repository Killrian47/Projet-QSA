{% extends 'base.html.twig' %}

{% block title %}Liste des entreprises - {{ parent() }}{% endblock %}

{% block body %}
    <div class="listing-entreprises-container">
        {% for entreprise in entreprises %}
            <div class="entreprise-container">
                <div class="d-flex justify-content-between">
                    <h4>{{ entreprise.name }}</h4>
                    {#                    <a class="" href="{{ path('app_entreprise', { id : entreprise.id}) }}">Détail de #}
                    {#                        l'entreprise</a> #}
                </div>

                <div class="order-of-entreprise">
                    <h5>Bon de commandes de l'entreprise :</h5>
                    {% set counter = 0 %}

                    {% if entreprise.orders is not empty %}
                        <table class="table">
                            <thead>
                            <tr>
                                <th scope="col">N<sup>o</sup></th>
                                <th scope="col" class="text-center">Nb échantillons</th>
                                <th scope="col" class="text-center">Exporté?</th>
                                <th scope="col" class="text-center">Crée le :</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for order in entreprise.orders %}
                                {% set countEchantillon = 0 %}

                                {% for echantillon in order.echantillons %}
                                    {% set countEchantillon = countEchantillon + 1 %}
                                {% endfor %}


                                {% if countEchantillon != 0 %}
                                    {% if counter < 5 %}
                                        <tr>
                                            <td>{{ order.id }}</td>
                                            <td class="text-center">{{ countEchantillon }}</td>
                                            {% if order.isExported == 0 %}
                                                <td class="text-center">Non</td>
                                            {% else %}
                                                <td class="text-center">Oui</td>
                                            {% endif %}
                                            <td class="text-center">{{ order.createdAt | date("d-m-Y") }}</td>
                                            <td>
                                                {#                                                <a class="qsa-alpha" #}
                                                {#                                                   href="{{ path('app_details_order', { id : order.id}) }}">+</a> #}
                                            </td>
                                        </tr>
                                    {% endif %}
                                    {% set counter = counter + 1 %}
                                {% endif %}
                            {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p class="mb-0 d-flex justify-content-center align-items-center fw-bold">Pas de bons de
                            commandes
                            pour
                            cette
                            entreprise</p>
                    {% endif %}

                </div>
            </div>
        {% endfor %}
    </div>

    <div class="pagination col-12">

        {% for page in pagination.pageRange %}
            {% if pagination.currentPageNumber == page %}
                <span>{{ page }}</span>
            {% else %}

                <a href="{{ path(app.request.attributes.get('_route'), app.request.query.all|merge({'page': page})) }}">{{ page }}</a>

            {% endif %}
        {% endfor %}

        {% set nbTotalPage = pagination.totalItemCount / pagination.itemNumberPerPage %}

        <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex">
                {% if pagination.currentPageNumber > 1 %}
                    <a class="me-3"
                       href="{{ path('app_entreprise', {'page': pagination.currentPageNumber - 1}) }}">Précédent</a>
                {% endif %}

                {% if pagination.currentPageNumber < nbTotalPage %}
                    <a href="{{ path('app_entreprise', {'page': pagination.currentPageNumber + 1}) }}">Suivant</a>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}
